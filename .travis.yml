language: ruby
sudo: false
cache: bundler

branches:
  only:
    - master
addons:
  apt:
    packages:
    - libcurl4-openssl-dev

env:
  global:
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true

jobs:
  include:
    - stage: test
      script: 'script/ci.rb'
      env: RUN=html_proofer
    - stage: test
      script: 'script/ci.rb'
      env: RUN=test
    - stage: test
      script: bundle exec jekyll build
      deploy:
        provider: pages
        local_dir: ./_site
        target_branch: gh_pages
        email: deploy@travis-ci.org
        name: Deployment Bot
        skip_cleanup: true
        github_token: $JEKYLL_PAT
        keep-history: true
        on:
          branch: master
